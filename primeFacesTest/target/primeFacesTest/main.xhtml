<?xml version="1.0" encoding="windows-1251"?>
<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"/>
        <title>Why are you not working?</title>
        <link type="text/css" rel="stylesheet" href="#{request.contextPath}/css/style.css" />
        <style type="text/css">
            .nestedUnit {
                border:0px none !important;
            }

            .ui-layout-center .ui-layout-resizer {
                border:1px solid #A8A8A8 !important;
            }

            html, body{
                height: 1080px;
                width: 100%;
                margin: 0;
                padding: 0;
                overflow: hidden;
            } 

            body {
                font-family: arial;
                font-size: 10pt;
                /* OPTIONAL */
                /*min-width: 600px;*/
                /*min-height: 500px;*/
                overflow: auto;
            } 

            .mainbody {
                min-height: 800px;
                height:auto;
            }

            .centered {
                margin:0px auto;
                text-align: center;
            }

            .table {
                width: 300px;
                height: auto;                
            }

            .title {
                margin:5px auto; 
                text-align: center;
                font-size: 30pt;
                font-family: Arial;
            }

            .top {
                height: 90;
            }
        </style>
    </h:head>

    <h:body onload="#{controllerManagedBean.search()}">
        <label style="margin:10px auto;text-align: center;font-size: 30pt;font-family: Arial;" >Web Music Catalog</label>
        <h:form id="form" styleClass="mainbody">
            <p:layout styleClass="height: 100%">
                <p:layoutUnit position="north" resizable="false" size="90" id="Head" styleClass="top">

                    <h:panelGrid columns="2" cellpadding="5" styleClass="centered">
                        <p:inputText id="search" size="60" value="#{controllerManagedBean.searchString}" />
                        <p:commandButton value="Search" update="basictable" action="#{controllerManagedBean.search()}"/>
                    </h:panelGrid>
                    <h:panelGrid columns="4" cellpadding="5" styleClass="centered">
                        <p:commandLink value="Top Group" update="topGroupsdialog" oncomplete="topGroupsDialog.show()"/>
                        <p:commandLink value="Selected Album Content" update="albumContentdialog" oncomplete="albumContentdialog.show()"/>
                        <p:commandLink value="Selected Musician Albums" update="musicianAlbumsDialog" oncomplete="musicianAlbumsDialog.show()"/>
                        <p:commandLink value="Rated Albums" update="ratedAlbumsDialog" oncomplete="ratedAlbumsDialog.show()"/>
                    </h:panelGrid>

                </p:layoutUnit>

                <p:layoutUnit id="Body" position="center" styleClass="mainbody" >
                    <p:layout>
                        <p:layoutUnit position="center"  resizable="true" styleClass="nestedUnit">
                            <p:panel>
                                <p:commandButton id="addTrackButton" value="Add" icon="ui-icon-squaresmall-plus"  
                                                 update=":form:addisplay" oncomplete="addDialog.show()" action="#{addDialogModelManagedBean.modeTrack()}"/>  
                                <p:commandButton id="editButton" value="Edit" icon="ui-icon-pencil"  
                                                 action="#{controllerManagedBean.edit}" ajax="false"/>
                                <p:commandButton id="deleteButton" value="Delete" icon="ui-icon-pencil"  
                                                 action="#{controllerManagedBean.deleteTracks()}" ajax="false" update="basictable"/>
                            </p:panel>
                            <p:dataTable  id="basictable" var="row" value="#{controllerManagedBean.maintable}"  styleClass="table, centered"
                                          selection="#{controllerManagedBean.selectedRows}" rowKey="#{row.trackId}" selectionMode="multiple">  
                                <p:column id="modelHeader">  
                                    <f:facet name="header">Group</f:facet>  
                                    <h:outputText value="#{row.groupName}" />  
                                </p:column>  

                                <p:column>  
                                    <f:facet name="header">Album</f:facet>  
                                    <h:outputText value="#{row.albumName}" />  
                                </p:column>  

                                <p:column>  
                                    <f:facet name="header">Track</f:facet>  
                                    <h:outputText value="#{row.trackName}" />  
                                </p:column>

                                <p:column>  
                                    <f:facet name="header">Rate</f:facet>  
                                    <h:outputText value="#{row.avrrate}">
                                        <f:convertNumber pattern = "##,##"/>
                                    </h:outputText>  
                                </p:column>

                                <p:column>  
                                    <f:facet name="header">Genre</f:facet>  
                                    <h:outputText value="#{row.genreName}" />  
                                </p:column>

                                <p:column>  
                                    <f:facet name="header">Mood</f:facet>  
                                    <h:outputText value="#{row.moodName}" />  
                                </p:column>
                            </p:dataTable> 
                        </p:layoutUnit>
                    </p:layout>                                    
                </p:layoutUnit>
            </p:layout>

            <p:dialog id="adddialog" header="Track Detail" widgetVar="addDialog" resizable="false" closable="false"
                      width="600" height="400" showEffect="fade" hideEffect="fade" modal="true">  
                <h:panelGrid id="addisplay"  styleClass="nestedUnit"> 

                    <p:panel id="trackPanel" header="Track #{addDialogModelManagedBean.track.name}" rendered="#{addDialogModelManagedBean.createTrackP()}">  
                        <h:panelGrid columns="3" style="width:100%">  

                            <h:column>
                                <h:outputText value="Name"/>   
                            </h:column>
                            <h:column colspan="2">
                                <p:inputText id="trackNameInput" value="#{addDialogModelManagedBean.track.name}" />
                            </h:column>
                            <h:column/>



                            <h:column>
                                <h:outputText value="Album" /> 
                            </h:column>
                            <h:column>
                                <p:autoComplete id="trackAlbum" dropdown="true" 
                                                completeMethod="#{addDialogModelManagedBean.completeAlbums}" 
                                                value="#{addDialogModelManagedBean.album}"
                                                var="a" itemLabel="#{a.name}" itemValue="#{a}"
                                                converter="albumConverter" 
                                                forceSelection="true" immediate="true" required="true">
                                    <p:ajax event="itemSelect" update="trackAlbum"/>
                                </p:autoComplete>
                            </h:column>
                            <h:column>
                                <p:commandButton id="newAlbumButton" value="+" update="addisplay" action="#{addDialogModelManagedBean.newAlbumEventHandler()}"/>
                            </h:column>



                            <p:column>
                                <h:outputText value="Mood" />
                            </p:column>
                            <p:column>
                                <p:autoComplete id="trackMood" dropdown="true" 
                                                completeMethod="#{addDialogModelManagedBean.completeMoods}" 
                                                value="#{addDialogModelManagedBean.mood}"
                                                var="a" itemLabel="#{a.name}" itemValue="#{a}"
                                                converter="moodConverter" 
                                                forceSelection="true" immediate="true" required="true">
                                    <p:ajax event="itemSelect" update="trackMood"/>
                                </p:autoComplete>
                            </p:column>
                            <p:column>
                                <p:commandButton id="newMoodButton" value="+" update="addisplay" action="#{addDialogModelManagedBean.newMoodEventHandler()}"/>
                            </p:column>

                        </h:panelGrid>  
                    </p:panel> 

                    <p:panel id="albumPanel" header="Album #{addDialogModelManagedBean.album.name}" rendered="#{addDialogModelManagedBean.createAlbumP()}">  
                        <h:panelGrid columns="3" style="width:100%"> 
                            <h:column>
                                <h:outputText value="Name"/>   
                            </h:column>
                            <h:column >
                                <p:inputText id="albumNameInput" value="#{addDialogModelManagedBean.album.name}" >
                                    <p:ajax event="keyup" update="trackAlbum"/>
                                </p:inputText>
                            </h:column>
                            <h:column/>

                            <h:column>
                                <h:outputText value="Group" /> 
                            </h:column>
                            <h:column>
                                <p:autoComplete id="albumGroup" dropdown="true" 
                                                completeMethod="#{addDialogModelManagedBean.completeGroups}" 
                                                value="#{addDialogModelManagedBean.group}"
                                                var="a" itemLabel="#{a.name}" itemValue="#{a}"
                                                converter="groupConverter" 
                                                forceSelection="true" immediate="true" required="true">
                                    <p:ajax event="itemSelect" update="albumGroup"/>
                                </p:autoComplete>
                            </h:column>
                            <h:column>
                                <p:commandButton id="newGroupButton" value="+" update="addisplay" action="#{addDialogModelManagedBean.newGroupEventHandler()}"/>
                            </h:column>

                            <h:column>
                                <h:outputText value="Genre" /> 
                            </h:column>
                            <h:column>
                                <p:autoComplete id="albumGenre" dropdown="true" 
                                                completeMethod="#{addDialogModelManagedBean.completeGenres}" 
                                                value="#{addDialogModelManagedBean.genre}"
                                                var="a" itemLabel="#{a.name}" itemValue="#{a}"
                                                converter="genreConverter" 
                                                forceSelection="true" immediate="true" required="true">
                                    <p:ajax event="itemSelect" update="albumGenre"/>
                                </p:autoComplete>
                            </h:column>
                            <h:column>
                                <p:commandButton id="newGenreButton" value="+" update="addisplay" action="#{addDialogModelManagedBean.newGenreEventHandler()}"/>
                            </h:column>
                        </h:panelGrid>  
                    </p:panel>

                    <p:panel id="groupPanel" header="Group #{addDialogModelManagedBean.group.name}" rendered="#{addDialogModelManagedBean.createGroupP()}">  
                        <h:panelGrid columns="3" style="width:100%">  
                            <h:column>
                                <h:outputText value="Name"/>   
                            </h:column>
                            <h:column >
                                <p:inputText id="groupNameInput" value="#{addDialogModelManagedBean.group.name}" >
                                    <p:ajax event="keyup" update="albumGroup"/>
                                </p:inputText>
                            </h:column>
                            <h:column/>

                            <h:column>
                                <h:outputText value="Members" /> 
                            </h:column>
                            <h:column>
                                <p:autoComplete id="membersAutoComplete" 
                                                value="#{addDialogModelManagedBean.members}" 
                                                completeMethod="#{addDialogModelManagedBean.completeMusicians}" 
                                                var="member" itemLabel="#{member.name}" 
                                                itemValue="#{member}" 
                                                converter="musicianConverter"
                                                forceSelection="true" immediate="true" multiple="true">
                                    <p:ajax event="itemUnselect" update="membersAutoComplete"/>
                                    <p:ajax event="itemSelect" update="membersAutoComplete"/>
                                </p:autoComplete>
                            </h:column>
                            <h:column>
                                <p:commandButton id="newMemberButton" value="+" update="addisplay" action="#{addDialogModelManagedBean.newMemberEventHandler()}"/>
                            </h:column>
                        </h:panelGrid>  
                    </p:panel>

                    <p:panel id="moodPanel" header="Mood #{addDialogModelManagedBean.mood.name}" rendered="#{addDialogModelManagedBean.createMoodP()}">  
                        <h:panelGrid columns="2" style="width:100%">  
                            <h:column>
                                <h:outputText value="Name"/>   
                            </h:column>
                            <h:column>
                                <p:inputText id="MoodNameInput" value="#{addDialogModelManagedBean.mood.name}" >
                                    <p:ajax event="keyup" update="trackMood"/>
                                </p:inputText>
                            </h:column>

                            <h:column>
                                <h:outputText value="Value"/>   
                            </h:column>
                            <h:column >
                                <p:inputText id="MoodValueInput" value="#{addDialogModelManagedBean.mood.value}" />
                            </h:column>
                        </h:panelGrid>  
                    </p:panel>

                    <p:panel id="memberPanel" header="Musician #{addDialogModelManagedBean.musician.name}" rendered="#{addDialogModelManagedBean.createMusicianP()}">  
                        <h:panelGrid columns="2" style="width:100%">  
                            <h:column>
                                <h:outputText value="Name"/>   
                            </h:column>
                            <h:column >
                                <p:inputText id="memberNameInput" value="#{addDialogModelManagedBean.musician.name}" />
                            </h:column>

                            <h:column>
                                <h:outputText value="Link"/>   
                            </h:column>
                            <h:column>
                                <p:inputText id="memberLinkInput" value="#{addDialogModelManagedBean.musician.link}" />
                            </h:column>
                        </h:panelGrid>  
                    </p:panel>

                    <p:panel id="genrePanel" header="Genre #{addDialogModelManagedBean.genre.name}" rendered="#{addDialogModelManagedBean.createGenreP()}">  
                        <h:panelGrid columns="2" style="width:100%">  
                            <h:column>
                                <h:outputText value="Name"/>   
                            </h:column>
                            <h:column >
                                <p:inputText id="genreNameInput" value="#{addDialogModelManagedBean.genre.name}" >
                                    <p:ajax event="keyup" update="albumGenre"/>
                                </p:inputText>
                            </h:column>
                        </h:panelGrid>  
                    </p:panel>

                    <p:panel id="commandPanel" name="footer">  
                        <p:commandButton id="createButton" update="addisplay" value="#{addDialogModelManagedBean.createUpdateButtonName}" action="#{addDialogModelManagedBean.createUpdate()}"/>                        
                        <p:commandButton id="backButton"   update="basictable"   value="Back"   action="#{addDialogModelManagedBean.backEventHandler()}"  oncomplete="addDialog.hide()" />  
                    </p:panel>
                </h:panelGrid>  
            </p:dialog>

            <p:dialog id="topGroupsdialog" header="Top Groups" widgetVar="topGroupsDialog" showEffect="fade" hideEffect="fade" width="600">
                <p:dataList value="#{controllerManagedBean.searchTopGroups()}" var="group" type="ordered" >
                    #{group.key}, rate 
                    <h:outputText value="#{group.value}">
                        <f:convertNumber pattern = "##,##"/>
                    </h:outputText>
                </p:dataList>
            </p:dialog> 

            <p:dialog id="albumContentdialog" header="Selected Album Content" widgetVar="albumContentdialog" showEffect="fade" hideEffect="fade" width="600">
                <p:dataTable  id="albumContenttable" var="row" value="#{controllerManagedBean.searchAlbumContent()}"  styleClass="table, centered">  
                    <p:column id="modelHeader">  
                        <f:facet name="header">Group</f:facet>  
                        <h:outputText value="#{row.key}" />  
                    </p:column>  

                    <p:column>  
                        <f:facet name="header">Track</f:facet>  
                        <h:outputText value="#{row.value}" />  
                    </p:column>  
                </p:dataTable> 
            </p:dialog>

            <p:dialog id="musicianAlbumsDialog" header="Musician albums" widgetVar="musicianAlbumsDialog" showEffect="fade" hideEffect="fade" width="600">
                <p:autoComplete id="musicianAlbumsAutoComplete" 
                                value="#{mainPageViewManagedBean.selectedMusician}" 
                                completeMethod="#{mainPageViewManagedBean.completeMusicians}" 
                                var="member" itemLabel="#{member.name}" 
                                itemValue="#{member}" 
                                converter="musicianConverter"
                                forceSelection="true" immediate="true" dropdown="true">
                                    <p:ajax event="itemSelect" update="musicianAlbumstable" listener="#{mainPageViewManagedBean.musicianSelect}"/>
                                </p:autoComplete>
                <p:dataTable  id="musicianAlbumstable" var="row" value="#{mainPageViewManagedBean.searchMusicianAlbums()}"  styleClass="table, centered">  
                    <p:column id="modelHeader">  
                        <f:facet name="header">Album</f:facet>  
                        <h:outputText value="#{row}" />  
                    </p:column>
                </p:dataTable> 
            </p:dialog>
            
            <p:dialog id="ratedAlbumsDialog" header="Rated albums" widgetVar="ratedAlbumsDialog" showEffect="fade" hideEffect="fade" width="600">
                <p:dataList value="#{controllerManagedBean.searcRatedAlbums()}" var="album" type="ordered" >
                    #{album.key}, rate 
                    <h:outputText value="#{album.value}">
                        <f:convertNumber pattern = "##,##"/>
                    </h:outputText>
                </p:dataList>
            </p:dialog>
        </h:form>            
    </h:body>
</html>
